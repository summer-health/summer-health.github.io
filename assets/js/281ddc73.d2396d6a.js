"use strict";(globalThis.webpackChunkexternal_blog=globalThis.webpackChunkexternal_blog||[]).push([[3879],{4070:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>c});var o=n(5335),i=n(5723),a=n(8202);const r={slug:"storybook-interactive-testing-with-mui",title:"Storybook Interactive Testing with MUI",description:"What we've learned about setting up interactive tests with Storybook and MUI.",authors:["eilinora"],tags:["storybook","mui","react","interactive","testing","interactivetesting"],image:"/img/storybook-interactive-test-behavior.png"},s="Improving FE Testing",l={authorsImageUrls:[void 0]},c=[{value:"Setting up your form story",id:"setting-up-your-form-story",level:2},{value:"Interactive testing with forms",id:"interactive-testing-with-forms",level:2},{value:"One last gotcha!",id:"one-last-gotcha",level:2},{value:"Time to wrap up!",id:"time-to-wrap-up",level:2}];function d(e){const t={a:"a",code:"code",h2:"h2",img:"img",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(t.p,{children:["Our team does a lot of our UI development in Storybook. If you are curious about how we manage our business logic, you can read more about how we build our UI components ",(0,i.jsx)(t.a,{href:"https://summer-health.github.io/blog/storybook-and-hocs-a-beautiful-friendship",children:"here"}),"."]}),"\n",(0,i.jsx)(t.p,{children:"Storybook has been working hard to improve its UI testing features and introduced integrated interactive testing in version 7, where you can build UI tests that can run in your preferred test runner. We decided to try this with our components, and this blog will go into what we have found so far with our experimentation."}),"\n",(0,i.jsx)(t.h2,{id:"setting-up-your-form-story",children:"Setting up your form story"}),"\n",(0,i.jsxs)(t.p,{children:["As mentioned, we use MUI as our design and component base for our components. We also use ",(0,i.jsx)(t.code,{children:"react-hook-form"})," to build our form management and ",(0,i.jsx)(t.code,{children:"contentful"})," to manage our page content. These packages and utilities make building components easier, but I noticed some quarks when attempting to build our interactive tests using Storybooks' new feature. To help others, I will walk through an example of our forms and then share some examples of our interactive tests to help others."]}),"\n",(0,i.jsx)(t.p,{children:"To help frame the test, below is an example of one of our forms shortened a little in the interest of brevity."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:'// imports.. removed for brevity\n\nexport interface FormContent {\n  overline: string;\n  header: string;\n  fieldsCollection: ContentfulFormInputCollection;\n  button: ContentfulButton;\n}\n\nexport interface FormFields {\n  firstName: string;\n  lastName: string;\n  dateOfBirth: Dayjs | null;\n  gender: string;\n  attestation: boolean;\n}\n\nexport interface FormProps {\n  content: FormContent;\n  disabledSubmit?: boolean;\n  methods: UseFormReturn<FormFields>;\n  onSubmit: () => Promise<void>;\n}\n\nexport const Form = ({\n  content,\n  disabledSubmit,\n  methods,\n  onSubmit,\n}: AddChildFormProps): JSX.Element => {\n  const {\n    control,\n    formState: { isSubmitting },\n  } = methods;\n  const { fieldsCollection } = content;\n  const gender = getFormFieldProperties({ fieldsCollection, name: \'gender\' });\n\n  return (\n    <Card variant="standard">\n      <CardHeader\n        title={\n          <>\n            <Typography variant="body2" color="sunrise.text-secondary">\n              {content.overline}\n            </Typography>\n            <Typography variant="h3">{content.header}</Typography>\n          </>\n        }\n      />\n      <CardContent>\n        <Stack spacing={2}>\n          <FormTextArea\n            control={control}\n            name="firstName"\n            label={\n              getFormFieldProperties({ fieldsCollection, name: \'firstName\' })\n                ?.label ?? \'First name\'\n            }\n            placeholder={\n              getFormFieldProperties({ fieldsCollection, name: \'firstName\' })\n                ?.placeholder\n            }\n            isRequired\n          />\n          <FormTextArea\n            control={control}\n            name="lastName"\n            label={\n              getFormFieldProperties({ fieldsCollection, name: \'lastName\' })\n                ?.label ?? \'Last name\'\n            }\n            placeholder={\n              getFormFieldProperties({ fieldsCollection, name: \'lastName\' })\n                ?.placeholder\n            }\n            isRequired\n          />\n          <FormDatePicker\n            control={control}\n            color="secondary"\n            name="dateOfBirth"\n            label={\n              getFormFieldProperties({ fieldsCollection, name: \'dateOfBirth\' })\n                ?.label ?? \'Date of Birth\'\n            }\n            disableFuture\n            disableHighlightToday\n            showDaysOutsideCurrentMonth\n            isRequired\n          />\n          <FormSelect\n            control={control}\n            name="gender"\n            label={\n              gender?.label ?? \'Birth Sex\'\n            }\n            placeholder={\n              gender?.placeholder\n            }\n            optionsCollection={\n              gender?.optionsCollection\n            }\n            isRequired\n          />\n          <Divider\n            variant="standard"\n            sx={(theme): object => ({\n              marginTop: `${theme.spacing(2.5)} !important`,\n              marginBottom: `${theme.spacing(2.5)} !important`,\n            })}\n          />\n          <FormCheckbox\n            control={control}\n            color="sunrise.text-primary"\n            name="attestation"\n            body={\n              getFormFieldProperties({ fieldsCollection, name: \'attestation\' })\n                ?.body\n            }\n            isRequired\n            sx={{\n              marginTop: \'0 !important\',\n            }}\n          />\n\n          <Divider variant="standard" />\n        </Stack>\n      </CardContent>\n      <CardActions>\n        {isSubmitting ? (\n          <LoadingButton color="secondary" fullWidth />\n        ) : (\n          <Button\n            disabled={disabledSubmit}\n            onClick={onSubmit}\n            testid={`form:submit`}\n            type="submit"\n            color="secondary"\n            fullWidth\n          >\n            {content?.button?.displayText}\n          </Button>\n        )}\n      </CardActions>\n    </Card>\n  );\n};\n'})}),"\n",(0,i.jsx)(t.p,{children:"And a screenshot of what our component looks like in Storybook."}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Form",src:n(8874).A+"",width:"2154",height:"1648"})}),"\n",(0,i.jsx)(t.p,{children:"Because the form setup happens outside the UI components, we can set up our stories, which build our content and form values for various form states if needed. Below is our simple empty-form story."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"import React from 'react';\nimport type { Meta, StoryObj } from '@storybook/react';\nimport { userEvent, within } from '@storybook/test';\nimport { useForm, FormProvider } from 'react-hook-form';\nimport {\n  FormContent,\n  FormFields,\n  Form as UIForm,\n} from '@summer-health/ui/care-form-date';\nimport dayjs from 'dayjs';\n\nconst meta: Meta = {\n  component: UIForm,\n  title: 'Components/Form',\n};\n\nexport default meta;\ntype Story = StoryObj<typeof meta>;\n\nconst content: FormContent = {\n  overline: \"Let's your information\",\n  header: 'Add your information',\n  button: {\n    displayText: 'Submit',\n  },\n  fieldsCollection: {\n    items: [\n      {\n        name: 'firstName',\n        label: 'First Name',\n      },\n      // ... removed for brevity\n    ],\n  },\n};\n\nconst render = (): JSX.Element => {\n  const defaultValues: AddChildFormFields = {\n    firstName: '',\n    lastName: '',\n    gender: '',\n    dateOfBirth: dayjs(),\n    attestation: false,\n  };\n  const methods = useForm<AddChildFormFields>({\n    defaultValues,\n    mode: 'onBlur',\n  });\n  const { handleSubmit, formState } = methods;\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const onSubmit = handleSubmit((data: any) => {\n    // eslint-disable-next-line no-console\n    console.log('submit me!', data);\n  });\n\n  return (\n    <FormProvider {...methods}>\n      <UIAddChildForm\n        content={content}\n        disabledSubmit={!formState.isValid}\n        methods={methods}\n        onSubmit={onSubmit}\n        pageSection=\"story\"\n      />\n    </FormProvider>\n  );\n};\n\n\nexport const DefaultForm: Story = {\n  render,\n};\n"})}),"\n",(0,i.jsx)(t.p,{children:"Now that we have that setup, let's talk about interactive tests. \ud83d\ude0a"}),"\n",(0,i.jsx)(t.h2,{id:"interactive-testing-with-forms",children:"Interactive testing with forms"}),"\n",(0,i.jsxs)(t.p,{children:["Storybook documentation has some simple examples of building an interaction which you can find ",(0,i.jsx)(t.a,{href:"https://storybook.js.org/docs/writing-tests/interaction-testing#write-an-interaction-test",children:"here"}),". Let's start with the overall interactive test."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"export const FilledForm: Story = {\n  play: async ({ canvasElement, step }) => {\n    const canvas = within(canvasElement.parentElement);\n\n    step('Fill out the form', async () => {\n      await userEvent.clear(await canvas.getByTestId('dateOfBirth'));\n\n      await userEvent.type(await canvas.getByTestId('firstName'), 'Jane');\n      await userEvent.type(await canvas.getByTestId('lastName'), 'Doe');\n\n      await userEvent.type(\n        await canvas.getByTestId('dateOfBirth'),\n        '02/02/2024',\n      );\n\n      await userEvent.click(await canvas.getByLabelText('Birth Sex'));\n\n      const presentation = within(canvas.getByRole('presentation'));\n      await userEvent.click(await presentation.getByTestId('Female'));\n\n      await userEvent.click(await canvas.getByTestId('attestation'));\n\n      await userEvent.click(await canvas.getByTestId('form:submit'));\n    });\n  },\n  render,\n};\n"})}),"\n",(0,i.jsx)(t.p,{children:"Now, let's walk through this test line by line."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"const canvas = within(canvasElement.parentElement);\n"})}),"\n",(0,i.jsxs)(t.p,{children:["If you've looked at the documentation in ",(0,i.jsx)(t.a,{href:"https://storybook.js.org/docs/writing-tests/interaction-testing",children:"Storybook docs"})," you will see that they set up their variable canvas by doing ",(0,i.jsx)(t.code,{children:"const canvas = within(canvasElement);"}),". This will give you the ",(0,i.jsx)(t.code,{children:'<div id="storybook-root">'})," element in the iframe. Although this is fine for most tests, if you're using MUI and have modals, popups, or dropdowns, you'll need to be able to access the whole ",(0,i.jsx)(t.code,{children:"body"})," of your storybook ",(0,i.jsx)(t.code,{children:"iframe"}),". Since the ",(0,i.jsx)(t.code,{children:"canvasElement"})," is a DOM element, you can use ",(0,i.jsx)(t.code,{children:"parentElement"})," to navigate up the DOM to the ",(0,i.jsx)(t.code,{children:"body"})," element. We can query the ",(0,i.jsx)(t.code,{children:"body"})," DOM element from here to get any element in the document ",(0,i.jsx)(t.code,{children:"body"}),". We'll talk more later about why we need to access the whole ",(0,i.jsx)(t.code,{children:"body"})," when we talk about activating our ",(0,i.jsx)(t.code,{children:"Select"})," component. For now, let's move to the following line."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"await userEvent.clear(await canvas.getByTestId('dateOfBirth'));\n"})}),"\n",(0,i.jsxs)(t.p,{children:["Along with using the MUI ",(0,i.jsx)(t.a,{href:"https://mui.com/material-ui/react-select/",children:"Select"})," component, our form uses MUI's ",(0,i.jsx)(t.a,{href:"https://mui.com/x/react-date-pickers/date-picker/",children:"DatePicker"})," component. When setting up your default form values, if you need to set up your form with a date, you'll need to be able to clear the date before you have the interactive test type in a new date option. You may have noticed that this is higher up in our test setup. This is because of an odd quirk: the value wont be set if you clear it right before typing. As of writing this, I'm unsure if this is an MUI issue or a Storybook issue. Clearing the value early works!"]}),"\n",(0,i.jsx)(t.p,{children:"Our basic setup is complete from here, and we can start interacting with the form."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"await userEvent.type(await canvas.getByTestId('firstName'), 'Jane');\nawait userEvent.type(await canvas.getByTestId('lastName'), 'Doe');\n"})}),"\n",(0,i.jsxs)(t.p,{children:["The above lines of code find the 2 ",(0,i.jsx)(t.a,{href:"https://mui.com/material-ui/react-text-field/",children:"TextField"})," components in our form by adding a ",(0,i.jsx)(t.code,{children:"data-testid"})," attribute on our ",(0,i.jsx)(t.code,{children:"TextField"})," component. In order to make the ",(0,i.jsx)(t.code,{children:"input"})," field findable in our form, we'll need to add this attribute to our react element. Here is a snippet of our reusable ",(0,i.jsx)(t.code,{children:"TextField"})," component we drop into all our forms. The ",(0,i.jsx)(t.code,{children:"inputProps"})," attribute on the ",(0,i.jsx)(t.code,{children:"TextField"})," component allows us to customize to the ",(0,i.jsx)(t.code,{children:"input"})," element."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-javascript",children:"<TextField\n  id={name}\n  inputProps={{\n    'data-testid': name,\n  }}\n  value={value}\n  label={label}\n/>\n"})}),"\n",(0,i.jsxs)(t.p,{children:["We must now do the same thing to our ",(0,i.jsx)(t.code,{children:"DatePicker"}),", which we'll interact with next. You'll want to add the ",(0,i.jsx)(t.code,{children:"data-testid"})," attribute to the ",(0,i.jsx)(t.code,{children:"input"})," field that is associated with the ",(0,i.jsx)(t.code,{children:"DatePicker"})," so you can type into it."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-javascript",children:"<DatePicker\n  slotProps={{\n    textField: {\n      color,\n      inputProps: {\n        'data-testid': name,\n      },\n    },\n  }}\n  value={value}\n  onChange={onChange}\n/>\n"})}),"\n",(0,i.jsxs)(t.p,{children:["Let's now interact with ",(0,i.jsx)(t.code,{children:"DatePicker"}),"."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-javascript",children:"await userEvent.type(await canvas.getByTestId('birthDate'), '02/02/2024');\n"})}),"\n",(0,i.jsx)(t.p,{children:"Now that we have the date entered, we can move on to selecting gender in our form."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"await userEvent.click(await canvas.getByLabelText('Birth Sex'));\n\nconst presentation = within(canvas.getByRole('presentation'));\nawait userEvent.click(await presentation.getByTestId('Female'));\n"})}),"\n",(0,i.jsxs)(t.p,{children:["First, we must activate the dropdown that appears with our ",(0,i.jsx)(t.a,{href:"https://mui.com/material-ui/react-select/",children:"Select"})," component. Unfortunately, as of this writing, the only way I've found to activate the ",(0,i.jsx)(t.code,{children:"Select"})," component is by clicking on the label text. Unfortunately, adding ",(0,i.jsx)(t.code,{children:"data-testid"})," to either the ",(0,i.jsx)(t.code,{children:"label"})," field or the ",(0,i.jsx)(t.code,{children:"Select"})," component didn't trigger the dropdown options to appear."]}),"\n",(0,i.jsxs)(t.p,{children:["As you'll remember, we use ",(0,i.jsx)(t.code,{children:"canvasElement.parentElement"})," to access our DOM's ",(0,i.jsx)(t.code,{children:"body"})," element. Once our dropdown options have been rendered, a new DOM element should be added called ",(0,i.jsx)(t.code,{children:"presentation"}),". From here, we can query the ",(0,i.jsx)(t.code,{children:"body"})," DOM to get the ",(0,i.jsx)(t.code,{children:"presentation"})," div element."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"const presentation = within(canvas.getByRole('presentation'));\n"})}),"\n",(0,i.jsxs)(t.p,{children:["This ",(0,i.jsx)(t.code,{children:"presentation"})," div is where MUI renders its modals, popups, and various other components that require that they have the highest z-index order in the DOM. After finding the ",(0,i.jsx)(t.code,{children:"presentation"})," DOM element, we can select one of our options."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"await userEvent.click(await presentation.getByTestId('Female'));\n"})}),"\n",(0,i.jsxs)(t.p,{children:["Fortunately, adding a ",(0,i.jsx)(t.code,{children:"data-testid"})," to our ",(0,i.jsx)(t.a,{href:"https://mui.com/material-ui/react-checkbox/",children:"Checkbox"})," component is straightforward. Just add ",(0,i.jsx)(t.code,{children:"data-testid={name}"})," to your component and it will make your component queryable."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"await userEvent.click(await canvas.getByTestId('attestation'));\n"})}),"\n",(0,i.jsxs)(t.p,{children:["Calling the ",(0,i.jsx)(t.code,{children:"click"})," action will now select the checkbox. Since all fields are required for our form to work as expected. Once all fields are filled in our submit button should now be activated. If your form submit button isn't active the test will fail because your button will not be in an active state."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"await userEvent.click(await canvas.getByTestId('form:submit'));\n"})}),"\n",(0,i.jsxs)(t.p,{children:["In this particular test, we don't need an ",(0,i.jsx)(t.code,{children:"expect"})," test as we are working to validate that the form activates when all fields are input and that all fields are interactable."]}),"\n",(0,i.jsx)(t.h2,{id:"one-last-gotcha",children:"One last gotcha!"}),"\n",(0,i.jsxs)(t.p,{children:["You may have noticed in documentation that you can break up interactions into multiple steps. Unfortunately, I've found that doing this doesn't fully fill in the form as expected. It will only partially fill out the form, and the test will fail. I'm unsure if this is an issue with the MUI framework or Storybook interactive testing library. For now, when it comes to forms, I would keep it all in one ",(0,i.jsx)(t.code,{children:"step"}),"."]}),"\n",(0,i.jsx)(t.h2,{id:"time-to-wrap-up",children:"Time to wrap up!"}),"\n",(0,i.jsx)(t.p,{children:"In our quest to enhance frontend testing, we dove headfirst into Storybook's latest feature: integrated interactive testing. Armed with excitement, we embarked on a journey of exploration, focusing keenly on optimizing form interactions. Storybook's version 7 has truly stepped up its game, seamlessly integrating with various testing runners, providing developers like us with a smoother testing experience."}),"\n",(0,i.jsxs)(t.p,{children:["As we tinkered with form setups within Storybook, we stumbled upon a few quirks, especially given our reliance on Material-UI (MUI), ",(0,i.jsx)(t.code,{children:"react-hook-form"}),", and ",(0,i.jsx)(t.code,{children:"contentful"}),". However, armed with determination, we charted a step-by-step path to crafting interactive tests for forms, serving as a beacon of guidance for fellow developers navigating similar waters. Along the way, we tackled nuances like clearing date fields, accessing dropdown options, and ensuring all form fields play nicely to activate the submit button. Although we faced a hiccup when breaking interactions into multiple steps, we pressed on, sharing our insights to foster a community of developers armed with stronger testing methodologies and a sprinkle of camaraderie."]})]})}function h(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},5335:e=>{e.exports=JSON.parse('{"permalink":"/blog/storybook-interactive-testing-with-mui","source":"@site/blog/2024-03-28-storybook-interactive-testing-with-mui/index.md","title":"Storybook Interactive Testing with MUI","description":"What we\'ve learned about setting up interactive tests with Storybook and MUI.","date":"2024-03-28T00:00:00.000Z","tags":[{"inline":true,"label":"storybook","permalink":"/blog/tags/storybook"},{"inline":true,"label":"mui","permalink":"/blog/tags/mui"},{"inline":true,"label":"react","permalink":"/blog/tags/react"},{"inline":true,"label":"interactive","permalink":"/blog/tags/interactive"},{"inline":true,"label":"testing","permalink":"/blog/tags/testing"},{"inline":true,"label":"interactivetesting","permalink":"/blog/tags/interactivetesting"}],"readingTime":8.795,"hasTruncateMarker":true,"authors":[{"name":"Lori Hutchek","imageURL":"https://github.com/eilinora.png","key":"eilinora","page":null}],"frontMatter":{"slug":"storybook-interactive-testing-with-mui","title":"Storybook Interactive Testing with MUI","description":"What we\'ve learned about setting up interactive tests with Storybook and MUI.","authors":["eilinora"],"tags":["storybook","mui","react","interactive","testing","interactivetesting"],"image":"/img/storybook-interactive-test-behavior.png"},"unlisted":false,"nextItem":{"title":"Storybook and HOCs a Beautiful Friendship \ud83e\udd1d","permalink":"/blog/storybook-and-hocs-a-beautiful-friendship"}}')},8202:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>s});var o=n(2155);const i={},a=o.createContext(i);function r(e){const t=o.useContext(a);return o.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),o.createElement(a.Provider,{value:t},e.children)}},8874:(e,t,n)=>{n.d(t,{A:()=>o});const o=n.p+"assets/images/form-2a1b0d498e6c27896f406873e959de9e.png"}}]);